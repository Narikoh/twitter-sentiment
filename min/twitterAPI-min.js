var express=require("express"),fs=require("fs"),bodyParser=require("body-parser"),request=require("request"),_=require("underscore"),T=require("twit"),datum=require("datumbox").factory("3f370865e56303cf6f145aa40485f1f0"),config=require("./config"),app=express(),router=express.Router(),parseJson=bodyParser.json(),twitter=new T({consumer_key:process.env.TWITTER_CONSUMER_KEY,consumer_secret:process.env.TWITTER_CONSUMER_SECRET,access_token:process.env.TWITTER_ACCESS_TOKEN_KEY,access_token_secret:process.env.TWITTER_ACCESS_TOKEN_SECRET}),keyword="";router.post("/",parseJson,function(e,r){function t(e){datum.twitterSentimentAnalysis(e.text,function(r,t){r&&console.log(r),s(e,t)})}function s(e,t){o.push({sentiment:t,created_at:e.created_at,timestamp_ms:e.timestamp_ms,id_str:e.id_str,user:{screen_name:e.user.screen_name,profile_image_url:e.user.profile_image_url,location:e.user.location,time_zone:e.user.time_zone},text:e.text,lang:e.lang}),5===o.length&&(n.stop(),r.send(o)),console.log("pushing sentiment"),console.log(o.length)}var o=[];console.log(e.body.query),keyword=e.body.query;var n=twitter.stream("statuses/filter",{language:"en",track:keyword});n.on("tweet",function(e){console.log("collecting data"),t(e)})}),module.exports=router;